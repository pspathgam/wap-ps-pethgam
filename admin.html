<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin — Zone Wagoora</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-slate-50 min-h-screen p-4">
  <div class="max-w-3xl mx-auto bg-white p-4 rounded shadow">
    <h2 class="text-xl font-bold">Admin — Create / Manage Quiz</h2>

    <label class="block mt-3">Select School (UDISE)</label>
    <input id="schoolId" class="w-full border p-2 rounded" placeholder="01022202207" />

    <label class="block mt-3">Quiz Title</label>
    <input id="title" class="w-full border p-2 rounded" placeholder="Quiz title"/>

    <label class="block mt-3">Class</label>
    <input id="cls" class="w-full border p-2 rounded" placeholder="5"/>

    <label class="block mt-3">Subject</label>
    <input id="subject" class="w-full border p-2 rounded" placeholder="Math"/>

    <div id="questionsArea" class="mt-4"></div>

    <div class="flex gap-2 mt-3">
      <button id="addQ" class="bg-gray-200 px-3 py-2 rounded">Add Question</button>
      <button id="saveQuiz" class="bg-green-600 text-white px-3 py-2 rounded">Save Quiz</button>
    </div>

    <hr class="my-4" />
    <h3 class="font-semibold">Upload School Logo</h3>
    <p class="text-sm text-gray-600 mb-2">Enter UDISE code and upload a PNG/JPG logo to Firebase Storage path `school_logos/{udise}.png`</p>
    <input id="logoUdise" class="w-full border p-2 rounded mb-2" placeholder="01022202207"/>
    <input id="logoFile" type="file" accept="image/*" class="mb-2" />
    <button id="uploadLogo" class="bg-blue-600 text-white px-3 py-2 rounded">Upload Logo</button>

  </div>

  <script type="module">
    import { addQuizWithQuestions, uploadSchoolLogo } from './js/app-utils.js';

    const questionsArea = document.getElementById('questionsArea');
    document.getElementById('addQ').addEventListener('click', addQuestionBlock);
    document.getElementById('saveQuiz').addEventListener('click', saveQuiz);
    document.getElementById('uploadLogo').addEventListener('click', uploadLogo);

    function addQuestionBlock(){
      const idx = questionsArea.childElementCount + 1;
      const div = document.createElement('div');
      div.className = 'border p-3 mb-2 rounded';
      div.innerHTML = `
        <label class="font-semibold">Q${idx} Text</label>
        <input class="qtext w-full border p-1 rounded mb-1" />
        <div class="grid grid-cols-1 gap-1">
          <input class="opt w-full border p-1 rounded" placeholder="Option 1"/>
          <input class="opt w-full border p-1 rounded" placeholder="Option 2"/>
          <input class="opt w-full border p-1 rounded" placeholder="Option 3"/>
          <input class="opt w-full border p-1 rounded" placeholder="Option 4"/>
        </div>
        <label class="mt-1">Correct option index (0-3)</label>
        <input class="correctIndex w-full border p-1 rounded" placeholder="0"/>
      `;
      questionsArea.appendChild(div);
    }

    async function saveQuiz(){
      const school = document.getElementById('schoolId').value.trim();
      const title = document.getElementById('title').value.trim();
      const cls = document.getElementById('cls').value.trim();
      const subject = document.getElementById('subject').value.trim();

      if(!school || !title || !cls){ alert('Please fill school, title and class'); return; }

      const blocks = questionsArea.querySelectorAll('.border');
      const questions = [];
      for(const b of blocks){
        const qtext = b.querySelector('.qtext').value;
        const opts = Array.from(b.querySelectorAll('.opt')).map(i=>i.value);
        const correctIndex = Number(b.querySelector('.correctIndex').value || 0);
        if(!qtext) continue;
        questions.push({ question: qtext, options: opts, correctIndex });
      }

      await addQuizWithQuestions(school, { title, class: cls, subject, totalQuestions: questions.length }, questions);
      alert('Quiz saved for school: ' + school);
      questionsArea.innerHTML = '';
      document.getElementById('title').value = '';
      document.getElementById('cls').value = '';
      document.getElementById('subject').value = '';
    }

    async function uploadLogo(){
      const udise = document.getElementById('logoUdise').value.trim();
      const file = document.getElementById('logoFile').files[0];
      if(!udise || !file) { alert('Enter UDISE and choose file'); return; }
      await uploadSchoolLogo(udise, file);
      alert('Logo uploaded to school_logos/' + udise + '.png');
    }
  </script>
</body>
</html>
