<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Pethgam Portal</title>
    <!-- Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Load Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // --- 1. YOUR FIREBASE CONFIGURATION ---
        // This is the object you copied from the Firebase console.
        const firebaseConfig = {
          apiKey: "AIzaSyCBLLmzxVYuivT15HBPPSxMoS2OzojRgJM",
          authDomain: "wap-ps-pethgam.firebaseapp.com",
          databaseURL: "https://wap-ps-pethgam-default-rtdb.firebaseio.com",
          projectId: "wap-ps-pethgam",
          storageBucket: "wap-ps-pethgam.firebasestorage.app",
          messagingSenderId: "430925411362",
          appId: "1:430925411362:web:22857dee585d02fc54467b"
        };
        // ------------------------------------

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Reference to the 'pethgam' path in the Realtime Database
        // This is where all location data will be stored.
        const pethgamRef = ref(database, 'pethgam');

        // Global variables for UI elements
        const portalStatusEl = document.getElementById('portal-status');
        const locationDisplayEl = document.getElementById('location-display');
        const errorEl = document.getElementById('error-message');

        // --- GEOLOCATION AND DATA UPLOAD ---

        // Function to handle successful geolocation retrieval
        function success(pos) {
            const crd = pos.coords;
            const timestamp = new Date().toLocaleString();

            const locationData = {
                latitude: crd.latitude,
                longitude: crd.longitude,
                accuracy: crd.accuracy,
                timestamp: timestamp,
                // Using a fixed ID for the "pethgam" device to simplify updates
                deviceId: 'pethgam-device' 
            };

            // Display current location locally
            locationDisplayEl.innerHTML = `
                <div class="text-xs font-semibold text-gray-500 mb-1">CURRENT DEVICE LOCATION</div>
                <p><strong>Latitude:</strong> ${crd.latitude.toFixed(6)}</p>
                <p><strong>Longitude:</strong> ${crd.longitude.toFixed(6)}</p>
                <p><strong>Accuracy:</strong> ${crd.accuracy.toFixed(2)} meters</p>
                <p><strong>Last Updated:</strong> ${timestamp}</p>
            `;

            // Clear any previous errors
            errorEl.textContent = '';
            
            // Update the single 'pethgam-device' node in the database
            const deviceRef = ref(database, 'pethgam/' + locationData.deviceId);
            update(deviceRef, locationData)
                .then(() => {
                    console.log("Location data saved successfully to Firebase.");
                    portalStatusEl.textContent = 'Portal is ACTIVE and sharing location.';
                    portalStatusEl.className = 'text-green-600 font-bold';
                })
                .catch((error) => {
                    console.error("Error saving location:", error);
                    errorEl.textContent = 'Error saving location data to Firebase. Check network/rules.';
                });
        }

        // Function to handle geolocation errors
        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
            errorEl.textContent = `Geolocation Error: ${err.message}. Please enable location services.`;
            portalStatusEl.textContent = 'Portal is INACTIVE: Location permission denied or unavailable.';
            portalStatusEl.className = 'text-red-600 font-bold';
        }

        // Options for geolocation
        const options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };

        // Watch position continuously (will run every few seconds/when position changes)
        let watchId = null;
        
        function startSharing() {
            if ("geolocation" in navigator) {
                // If sharing is already active, clear it first
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                }
                
                portalStatusEl.textContent = 'Attempting to get location...';
                portalStatusEl.className = 'text-yellow-600 font-bold';
                
                // Start watching the position
                watchId = navigator.geolocation.watchPosition(success, error, options);
                
                document.getElementById('start-btn').classList.add('bg-gray-500', 'cursor-not-allowed');
                document.getElementById('start-btn').classList.remove('bg-green-600', 'hover:bg-green-700');
                document.getElementById('start-btn').textContent = 'Sharing Active';

                document.getElementById('stop-btn').classList.add('bg-red-600', 'hover:bg-red-700');
                document.getElementById('stop-btn').classList.remove('bg-gray-500', 'cursor-not-allowed');

            } else {
                errorEl.textContent = 'Geolocation is not supported by this browser.';
                portalStatusEl.textContent = 'Portal is INACTIVE: Browser unsupported.';
                portalStatusEl.className = 'text-red-600 font-bold';
            }
        }
        
        function stopSharing() {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
                portalStatusEl.textContent = 'Portal is Stopped.';
                portalStatusEl.className = 'text-red-600 font-bold';
                
                document.getElementById('start-btn').classList.remove('bg-gray-500', 'cursor-not-allowed');
                document.getElementById('start-btn').classList.add('bg-green-600', 'hover:bg-green-700');
                document.getElementById('start-btn').textContent = 'Start Sharing';

                document.getElementById('stop-btn').classList.remove('bg-red-600', 'hover:bg-red-700');
                document.getElementById('stop-btn').classList.add('bg-gray-500', 'cursor-not-allowed');
            }
        }

        // --- REAL-TIME DATA LISTENER ---

        // Function to listen for real-time updates from the database
        function setupDataListener() {
            const remoteDisplayEl = document.getElementById('remote-location-display');
            const mapLinkEl = document.getElementById('map-link');

            // Listen for changes to the 'pethgam' node
            onValue(pethgamRef, (snapshot) => {
                const data = snapshot.val();
                
                if (data && data['pethgam-device']) {
                    const remoteData = data['pethgam-device'];
                    
                    // Display the remote location data
                    remoteDisplayEl.innerHTML = `
                        <div class="text-xs font-semibold text-gray-500 mb-1">SHARED LOCATION (From Other Device)</div>
                        <p><strong>Latitude:</strong> ${remoteData.latitude.toFixed(6)}</p>
                        <p><strong>Longitude:</strong> ${remoteData.longitude.toFixed(6)}</p>
                        <p><strong>Accuracy:</strong> ${remoteData.accuracy.toFixed(2)} meters</p>
                        <p><strong>Last Shared:</strong> ${remoteData.timestamp}</p>
                    `;
                    
                    // Update the Google Maps link
                    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${remoteData.latitude},${remoteData.longitude}`;
                    mapLinkEl.href = mapUrl;
                    mapLinkEl.classList.remove('hidden');
                    mapLinkEl.textContent = 'View Remote Location on Google Maps';

                } else {
                    remoteDisplayEl.innerHTML = '<div class="text-red-500">No shared location data found in the database.</div>';
                    mapLinkEl.classList.add('hidden');
                }
            }, {
                // Handle potential read errors (e.g., if rules were wrong, but they are public now)
                onlyOnce: false
            });
        }

        // --- INITIALIZATION ---

        window.onload = function() {
            // Attach event listeners to buttons
            document.getElementById('start-btn').addEventListener('click', startSharing);
            document.getElementById('stop-btn').addEventListener('click', stopSharing);

            // Set initial status
            portalStatusEl.textContent = 'Portal is ready. Click "Start Sharing" to begin.';
            portalStatusEl.className = 'text-blue-600 font-bold';
            
            // Start listening for remote data immediately
            setupDataListener();

            // Set initial state of buttons
            document.getElementById('stop-btn').classList.add('bg-gray-500', 'cursor-not-allowed');
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .shadow-soft {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-start justify-center">

    <div class="w-full max-w-lg space-y-6">

        <!-- Header and Status -->
        <header class="text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Pethgam Location Portal</h1>
            <p id="portal-status" class="text-lg text-blue-600 font-bold"></p>
            <p id="error-message" class="text-sm text-red-500 mt-2"></p>
        </header>

        <!-- Control Panel -->
        <div class="card bg-white p-6 rounded-xl border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Control Sharing</h2>
            <p class="text-sm text-gray-500 mb-4">
                Click 'Start Sharing' to continuously upload this device's current location to the database.
            </p>
            <div class="flex space-x-4">
                <button id="start-btn" class="flex-1 px-4 py-3 rounded-lg font-semibold transition duration-200 bg-green-600 text-white hover:bg-green-700 shadow-soft">
                    Start Sharing
                </button>
                <button id="stop-btn" class="flex-1 px-4 py-3 rounded-lg font-semibold transition duration-200 text-white shadow-soft">
                    Stop Sharing
                </button>
            </div>
        </div>

        <!-- Local Device Location Display -->
        <div class="card bg-white p-6 rounded-xl border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Your Device Location</h2>
            <div id="location-display" class="text-sm text-gray-600 space-y-1">
                <p>Location data will appear here once sharing starts.</p>
            </div>
        </div>

        <!-- Remote (Shared) Location Display -->
        <div class="card bg-white p-6 rounded-xl border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Remote Shared Location</h2>
            <div id="remote-location-display" class="text-sm text-gray-600 space-y-1 mb-4">
                <div class="text-blue-500">Waiting for real-time data from the database...</div>
            </div>
            
            <a id="map-link" href="#" target="_blank" class="hidden text-center block w-full bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600 transition duration-200 shadow-soft mt-4">
                View Remote Location on Google Maps
            </a>
        </div>
        
        <!-- Instruction Footer -->
        <footer class="text-center text-xs text-gray-500 pt-4">
            <p>This portal is powered by Firebase Realtime Database for real-time, cross-device synchronization.</p>
            <p>Database URL: wap-ps-pethgam-default-rtdb.firebaseio.com</p>
        </footer>

    </div>
</body>
</html>













                    

        .        .                           .
